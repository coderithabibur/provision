function receiveSettings(e){if(e.origin===location.origin)return receiveInternalData(e);if(e.origin!==TRUSTPILOT_INTEGRATION_APP_URL)return;const t=e.data;if("string"==typeof t)if(t.startsWith("sync:")||t.startsWith("showPastOrdersInitial:")){const e=t.split(":"),s={action:"handle_past_orders"};s[e[0]]=e[1],this.submitPastOrdersCommand(s)}else if(t.startsWith("resync")){const e={action:"handle_past_orders",resync:"resync"};this.submitPastOrdersCommand(e)}else if(t.startsWith("issynced")){const e={action:"handle_past_orders",issynced:"issynced"};this.submitPastOrdersCommand(e)}else if(t.startsWith("check_product_skus")){const e=t.split(":"),s={action:"check_product_skus"};s.skuSelector=e[1],this.submitCheckProductSkusCommand(s)}else this.handleJSONMessage(t)}function receiveInternalData(e){const t=e.data,s={};t&&"string"==typeof t&&tryParseJson(t,s)&&("updatePageUrls"!==s.type&&"newTrustBox"!==s.type||this.submitSettings(s))}function handleJSONMessage(e){const t={};if(tryParseJson(e,t))if(t.TrustBoxPreviewMode)this.trustBoxPreviewMode(t);else if(t.window)this.updateIframeSize(t);else if("submit"===t.type)this.submitSettings(t);else if(t.trustbox){document.getElementById("trustbox_preview_frame").contentWindow.postMessage(JSON.stringify(t.trustbox),"*")}}function trustBoxPreviewMode(e){const t=document.getElementById("trustpilot-trustbox-preview");e.TrustBoxPreviewMode.enable?t.hidden=!1:t.hidden=!0}function encodeSettings(e){let t="";for(const s in e)t+=`${s}=${e[s]}&`;return t.substring(0,t.length-1)}function getFormValues(e){let t={};for(const s in e.elements){const n=e.elements[s];"INPUT"===n.nodeName&&(t[n.name]=n.value)}return t}function getTokenKeyValue(){return getURLVar("token")?`&token=${getURLVar("token")}`:getURLVar("user_token")?`&user_token=${getURLVar("user_token")}`:void 0}function submitPastOrdersCommand(e){const t=new XMLHttpRequest;t.open("POST",`/index.php?route=extension/trustpilot/ajax${getTokenKeyValue()}`),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){4===t.readyState&&(t.status>=400?console.log(`callback error: ${t.response} ${t.status}`):sendPastOrdersInfo(t.response))},t.send(encodeSettings(e))}function submitCheckProductSkusCommand(e){const t=new XMLHttpRequest;t.open("POST",`/index.php?route=extension/trustpilot/ajax${getTokenKeyValue()}`),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){if(4===t.readyState)if(t.status>=400)console.log(`callback error: ${t.response} ${t.status}`);else{const e=document.getElementById("configuration_iframe");e.contentWindow.postMessage(t.response,e.dataset.transfer)}},t.send(encodeSettings(e))}function submitSettings(e){let t={action:"handle_save_changes"};"updatePageUrls"===e.type?t.pageUrls=encodeURIComponent(JSON.stringify(e.pageUrls)):"newTrustBox"===e.type?t.customTrustBoxes=encodeURIComponent(JSON.stringify(e)):(t.settings=encodeURIComponent(JSON.stringify(e.settings)),document.getElementById("trustbox_preview_frame").dataset.settings=btoa(t.settings));const s=new XMLHttpRequest;s.open("POST",`/index.php?route=extension/trustpilot/ajax${getTokenKeyValue()}`),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(encodeSettings(t))}function updateIframeSize(e){const t=document.getElementById("configuration_iframe");t&&(t.height=e.window.height+"px")}function sendSettings(){const e=document.getElementById("configuration_iframe"),t=e.dataset,s=JSON.parse(atob(t.settings));if(s.trustbox||(s.trustbox={}),s.trustbox.pageUrls=JSON.parse(atob(t.pageUrls)),s.pluginVersion=t.pluginVersion,s.source=t.source,s.version=t.version,s.basis="plugin",s.productIdentificationOptions=JSON.parse(t.productIdentificationOptions),s.configurationScopeTree=JSON.parse(atob(t.configurationScopeTree)),s.isFromMarketplace=JSON.parse(t.isFromMarketplace),s.pluginStatus=JSON.parse(atob(t.pluginStatus)),s.trustbox.trustboxes&&t.sku)for(trustbox of s.trustbox.trustboxes)trustbox.sku=t.sku;if(s.trustbox.trustboxes&&t.name)for(trustbox of s.trustbox.trustboxes)trustbox.name=t.name;e.contentWindow.postMessage(JSON.stringify(s),t.transfer)}function sendPastOrdersInfo(e){const t=document.getElementById("configuration_iframe"),s=t.dataset;void 0===e&&(e=s.pastOrders),t.contentWindow.postMessage(e,s.transfer)}function tryParseJson(e,t){try{t=Object.assign(t,JSON.parse(e))}catch(e){return!1}return!0}window.addEventListener("message",this.receiveSettings);
//# sourceMappingURL=integrate.min.js.map